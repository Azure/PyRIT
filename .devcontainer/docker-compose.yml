services:
  devcontainer:
    platform: linux/amd64
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
    deploy:
      resources:
        limits:
          cpus: "4"
          memory: "16G"
    volumes:
      - ..:/workspace:delegated
      - pip-cache:/home/vscode/.cache/pip:cached
      - uv-cache:/home/vscode/.cache/uv:cached
      - precommit-cache:/home/vscode/.cache/pre-commit:cached
      - ty-cache:/workspace/.ty_cache:cached
      - pylance-cache:/home/vscode/.cache/pylance:cached
      - node-modules:/workspace/frontend/node_modules:cached
      - ~/.pyrit:/home/vscode/.pyrit:cached
    network_mode: "host"
    # Note: ports section is not needed with host network mode
    # The container will have direct access to all host network interfaces
    # Keep the container running so the post-create command can execute.
    command: "sleep infinity"

volumes:
  pip-cache:
  uv-cache:
  precommit-cache:
  ty-cache:
  pylance-cache:
  node-modules:
