# Builds the pyrit environment and runs all tests and pre-commit hooks

name: build_and_test

on:
  push:
    branches:
      - "main"
  pull_request:
    branches:
      - "main"
      - "release/**"
  workflow_dispatch:

concurrency:
  # This ensures after each commit the old jobs are cancelled and the new ones
  # run instead.
  group: ${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  integration-tests:
    strategy:
      matrix:
        os: [ubuntu-latest]
        python: ["3.10"]
        package_name: ["pyrit"]
    runs-on: ${{ matrix.os }}
    environment: integration_test
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v3
        with:
          python-version: ${{ matrix.python }}
      - name: Setting environment test secrets
        env:
          AZURE_OPENAI_CHAT_ENDPOINT: ${{ secrets.AZURE_OPENAI_CHAT_ENDPOINT }}
          TEST_VAR: ${{ vars.TEST }}
        run: |
              echo "test value: $TEST_VAR"
              if [ -z "${AZURE_OPENAI_CHAT_ENDPOINT}" ]; then
                echo "Secret is not available or is blank."
              else
                echo "Secret is available."
              fi